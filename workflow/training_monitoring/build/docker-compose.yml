version: '3'

services:
    server:
        build:
            context: .
            dockerfile: Dockerfile
        entrypoint: [ python, /flower/server.py ]
        environment:
            - JOB_ID=${JOB_ID}
            - NODE_ID=0
        ports: 
            - "8080:8080"
        volumes:
            - ../src:/flower
        links:
            - "logger:logger"
    
    client_a:
        build:
            context: .
            dockerfile: Dockerfile
        entrypoint: [ python, /flower/client.py ]
        environment:
            - JOB_ID=${JOB_ID}
            - NODE_ID=1
        ports: 
            - "8081:8080"
        volumes:
            - ../src:/flower
        links:
            - "server:server"
            - "logger:logger"

    client_b:
        build:
            context: .
            dockerfile: Dockerfile
        entrypoint: [ python, /flower/client.py ]
        environment:
            - JOB_ID=${JOB_ID}
            - NODE_ID=2
        ports: 
            - "8082:8080"
        volumes:
            - ../src:/flower
        links:
            - "server:server"
            - "logger:logger"

    logger:
        image: prom/pushgateway
        ports: 
            - 9091:9091